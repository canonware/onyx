# -*-mode:makefile-*-
# @configure_input@
#############################################################################
#
# Copyright (c) 1996-1998
# Jason Evans <jasone@canonware.com>.  All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer as
#    the first lines of this file unmodified.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY JASON EVANS ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL JASON EVANS BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#############################################################################
#
# $Source$
# $Author: jasone $
# Current revision: $Revision: 6 $
# Last modified: $Date: 1998-01-16 00:20:41 -0800 (Fri, 16 Jan 1998) $
#
# Description: Makefile for SQuirreL source code.
#              
##############################################################################

#
# external variables
#

SHELL   = /bin/sh
MAKE    = @MAKE@
CC	= @CC@
AR	= @AR@
FLEX    = @FLEX@
BISON   = @BISON@
RANLIB	= @RANLIB@
INSTALL	= @INSTALL@

INCS    = -I@top_srcdir@ -I@top_srcdir@/lib_common/include
CFLAGS  = @CFLAGS@

DEFINES = -D_REENTRANT @DEFS@
LIBS    = -L@top_srcdir@/src $(STATLIB:%=-l%) @LIBS@

FLEXFLAGS = -CF
BISONFLAGS = 

#
# variables
#

# file lists
SRCS     = log.c res_lexer.yy.c
OBJS     = $(SRCS:.c=.o)
DIRS     = 
STATLIB  = common
TARGETS  = 

#
# implicit rules
#

.SUFFIXES:
.SUFFIXES: .c .h .o .d .l .y .yy.c

.c.o:
	$(CC) -c $< $(CFLAGS) $(INCS) $(DEFINES)

.l.yy.c:
	$(FLEX) $(FLEXFLAGS) -o$@ $<

.y.yy.c:
	$(BISON) $(BISONFLAGS) -o $@ $<

#
# user 'make'ables
#

all: suball hereall FORCE

check: subcheck herecheck FORCE

install: subinstall hereinstall FORCE

uninstall: subuninstall hereuninstall FORCE

clean: subclean hereclean FORCE

distclean: subdistclean hereclean heredistclean FORCE

targets:
	@echo "User 'make'ables: all (default)"
	@echo "                  check"
	@echo "                  install"
	@echo "                  uninstall"
	@echo "                  clean"
	@echo "                  distclean"
	@echo "                  targets"

#
# internal build rules
#

FORCE:

# all
suball:
	@$(SHELL) -c 'for i in $(DIRS); do cd $$i; $(MAKE) -i all; cd -; done'

hereall: $(TARGETS) $(STATLIB:%=lib%.a)

# check
subcheck:
	@$(SHELL) -c \
	'for i in $(DIRS); do cd $$i; $(MAKE) -i check; cd -; done'

herecheck:

# install
subinstall:
	@$(SHELL) -c \
	'for i in $(DIRS); do cd $$i; $(MAKE) -i install; cd -; done'

hereinstall: hereall
	$(SHELL) -c '$(INSTALL) -d -m 755 @prefix@/bin/'
	$(SHELL) -c \
	'for i in $(TARGETS); do \
	$(INSTALL) -s -m 755 $$i @prefix@/bin/$$i; done'

# uninstall
subuninstall:
	@$(SHELL) -c \
	'for i in $(DIRS); do cd $$i; $(MAKE) -i uninstall; cd -; done'

hereuninstall: 
	@$(SHELL) -c \
	'for i in $(TARGETS); do rm -f @prefix@/bin/$$i; done'

# clean
subclean:
	@$(SHELL) -c \
	'for i in $(DIRS); do cd $$i; $(MAKE) -i clean; cd -; done'

hereclean:
	rm -f *.o *~ *.d
	rm -f $(STATLIB:%=lib%.a)
	rm -f *.bak *.BAK
	rm -f core

# distclean
subdistclean:
	@$(SHELL) -c \
	'for i in $(DIRS); do cd $$i; $(MAKE) -i distclean; cd -; done'

heredistclean:
	rm -f "#"*"#"
	rm -f $(OBJS) $(TARGETS)
	rm -f Makefile

$(STATLIB:%=lib%.a): $(OBJS)
	$(AR) cr $@ $?
	$(RANLIB) $@

$(TARGETS): $(STATLIB:%=lib%.a) $(TARGETS:=.o)
	$(CC) -o $@ $(@:=.o) $(LIBS)

#
# Rule for dependency file creation
#

%.d: %.c
	$(SHELL) -ec "$(CC) -M $(DEFINES) $(INCS) $< \
	| sed \"s/\($*\)\.o\([ :]*\)/\1.o \1.d \2/g\" > $@"

#
# Include dependencies.
#

include $(SRCS:.c=.d) $(TARGETS:=.d)
