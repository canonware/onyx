%-*-mode:latex-*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% <Copyright = jasone>
% <License>
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Version: <Version>
%
% mq portion of Canonware Software Manual.
%              
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{mq}
\label{mq}
\index{\classname{mq}{}}

The \classname{mq} class implements a simple unidirectional message queue.
In addition to putting and getting messages, there are methods that control
the ability to get or put.  This provides a simple out of band state
transition capability.

\subsubsection{API}
\begin{description}
\label{mq_new}
\index{\cfunc{mq\_new}{}}
\item[{\cfunc[void]{mq\_new}{cw\_mq\_t *a\_mq, cw\_mem\_t *a\_mem,
cw\_uint32\_t a\_msg\_size}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to space for a \classname{mq}.
		\item[a\_mem: ]
			Pointer to the allocator to use internally.
		\item[a\_msg\_size: ]
			Size (in bytes) of messages used for all subsequent
			calls to \cfunc{mq\_*get}{} and \cfunc{mq\_put}{}.
		\end{description}
	\item[Output(s): ] None.
	\item[Exception(s): ]
		\begin{description}\item[]
		\item[\htmlref{\_CW\_STASHX\_OOM}{_CW_STASHX_OOM}.]
		\end{description}
	\item[Description: ]
		Constructor.
	\end{description}
\label{mq_delete}
\index{\cfunc{mq\_delete}{}}
\item[{\cfunc[void]{mq\_delete}{cw\_mq\_t *a\_mq}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\end{description}
	\item[Output(s): ] None.
	\item[Exception(s): ] None.
	\item[Description: ]
		Destructor.
	\end{description}
\label{mq_tryget}
\index{\cfunc{mq\_tryget}{}}
\item[{\cfunc[cw\_bool\_t]{mq\_tryget}{cw\_mq\_t *a\_mq, ...}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\item[...: ]
			Pointer to space to store a message.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] No messages in the queue, or get is
				in the stop state.
			\end{description}
		\item[*...: ]
			If \cvar{retval} is FALSE, a message.  Otherwise,
			undefined.
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Try to get a message, but return TRUE if none are available.
	\end{description}
\label{mq_timedget}
\index{\cfunc{mq\_timedget}{}}
\item[{\cfunc[cw\_bool\_t]{mq\_}{cw\_mq\_t *a\_mq, const struct timespec
*a\_timeout, ...}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\item[a\_timeout: ]
			Timeout, specified as an absolute time interval.
		\item[...: ]
			Pointer to space to store a message.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] No messages in the queue, or get is
				in the stop state.
			\end{description}
		\item[*...: ]
			If \cvar{retval} is FALSE, a message.  Otherwise,
			undefined.
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Get a message.  If none are available, block until a
		message is available, or until timeout.
	\end{description}
\label{mq_get}
\index{\cfunc{mq\_get}{}}
\item[{\cfunc[cw\_bol\_t]{mq\_}{cw\_mq\_t *a\_mq, ...}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\item[...: ]
			Pointer to space to store a message.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] No messages in the queue, or get is
				in the stop state.
			\end{description}
		\item[*...: ]
			If \cvar{retval} is FALSE, a message.  Otherwise,
			undefined.
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Get a message.  If none are available, block until a
		message is available.
	\end{description}
\label{mq_put}
\index{\cfunc{mq\_put}{}}
\item[{\cfunc[cw\_bool\_t]{mq\_put}{cw\_mq\_t *a\_mq, ...}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\item[...: ]
			A message.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] Failure due to put being in the stop
				state.
			\end{description}
		\end{description}
	\item[Exception(s): ]
		\begin{description}\item[]
		\item[\htmlref{\_CW\_STASHX\_OOM}{_CW_STASHX_OOM}.]
		\end{description}
	\item[Description: ]
		Put a message in \cvar{a\_mq}.
	\end{description}
\label{mq_get_start}
\index{\cfunc{mq\_get\_start}{}}
\item[{\cfunc[cw\_bool\_t]{mq\_get\_start}{cw\_mq\_t *a\_mq}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] Error (already in start state).
			\end{description}
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Change the get operation to the start state
		(\cfunc{mq\_get}{} will not return TRUE).
	\end{description}
\label{mq_get_stop}
\index{\cfunc{mq\_get\_stop}{}}
\item[{\cfunc[cw\_bool\_t]{mq\_get\_stop}{cw\_mq\_t *a\_mq}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] Error (already in stop state).
			\end{description}
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Change the get operation to the stop state
		(\cfunc{mq\_get}{} will return TRUE).
	\end{description}
\label{mq_put_start}
\index{\cfunc{mq\_put\_start}{}}
\item[{\cfunc[cw\_bool\_t]{mq\_put\_start}{cw\_mq\_t *a\_mq}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] Error (already in start state).
			\end{description}
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Change the put operation to the start state
		(\cfunc{mq\_put}{} will not return TRUE).
	\end{description}
\label{mq_put_stop}
\index{\cfunc{mq\_put\_stop}{}}
\item[{\cfunc[cw\_bool\_t]{mq\_put\_stop}{cw\_mq\_t *a\_mq}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] Error (already in stop state).
			\end{description}
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Change the put operation to the stop state
		(\cfunc{mq\_put}{} will return TRUE).
	\end{description}
\label{mq_dump}
\index{\cfunc{mq\_dump}{}}
\item[{\cfunc[void]{mq\_dump}{cw\_mq\_t *a\_mq, const char *a\_prefix}}: ]
	\begin{description}\item[]
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_mq: ]
			Pointer to a \classname{mq}.
		\item[a\_prefix: ]
			Pointer to a string to prefix to all lines of output
		\end{description}
	\item[Output(s): ]
		Output printed to \cvar{out\_err}.
	\item[Exception(s): ]
		\begin{description}\item[]
		\item[\htmlref{\_CW\_STASHX\_OOM}{_CW_STASHX_OOM}.]
		\end{description}
	\item[Description: ]
		Print the internal state of \cvar{a\_mq} to \cvar{out\_err}.
	\end{description}
\end{description}
