%-*-mode:latex-*-
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% <Copyright = jasone>
% <License>
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Version: <Version>
%
% sma portion of Onyx Manual.
%              
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{sma}
\label{sma}
\index{sma@\classname{sma}{}}

The \classname{sma} class implements semaphores.  This implementation is a bit
different than normal, in that it is possible to decrement the count to less
than zero.  This allows dynamic modification of resource pools locked by
semaphores.

\subsubsection{API}
\begin{capi}
\label{sma_new}
\index{sma_new@\cfunc{sma\_new}{}}
\citem{\cfunc[cw\_sma\_t *]{sma\_new}{cw\_sma\_t *a\_sma, cw\_sint32\_t
a\_count}}
	\begin{capilist}
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_sma: ]
			Pointer to space for a \classname{sma}.
		\item[a\_count: ]
			Initial value of semaphore.
		\end{description}
	\item[Output(s): ] None.
	\item[Exception(s): ] None.
	\item[Description: ]
		Constructor.
	\end{capilist}
\label{sma_delete}
\index{sma_delete@\cfunc{sma\_delete}{}}
\citem{\cfunc[void]{sma\_delete}{cw\_sma\_t *a\_sma}}
	\begin{capilist}
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_sma: ]
			Pointer to a \classname{sma}.
		\end{description}
	\item[Output(s): ] None.
	\item[Exception(s): ] None.
	\item[Description: ]
		Destructor.
	\end{capilist}
\label{sma_post}
\index{sma_post@\cfunc{sma\_post}{}}
\citem{\cfunc[void]{sma\_post}{cw\_sma\_t *a\_sma}}
	\begin{capilist}
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_sma: ]
			Pointer to a \classname{sma}.
		\end{description}
	\item[Output(s): ] None.
	\item[Exception(s): ] None.
	\item[Description: ]
		Post (increment) \cvar{a\_sma}.
	\end{capilist}
\label{sma_wait}
\index{sma_wait@\cfunc{sma\_wait}{}}
\citem{\cfunc[void]{sma\_wait}{cw\_sma\_t *a\_sma}}
	\begin{capilist}
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_sma: ]
			Pointer to a \classname{sma}.
		\end{description}
	\item[Output(s): ] None.
	\item[Exception(s): ] None.
	\item[Description: ]
		Wait on (block until able to decrement) \cvar{a\_sma}.
	\end{capilist}
\label{sma_timedwait}
\index{sma_timedwait@\cfunc{sma\_timedwait}{}}
\citem{\cfunc[cw\_bool\_t]{sma\_timedwait}{cw\_sma\_t *a\_sma, struct
timespec *a\_timeout}}
	\begin{capilist}
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_sma: ]
			Pointer to a \classname{sma}.
		\item[a\_timeout: ]
			Timeout, specified as an absolute time interval.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] Failure.
			\end{description}
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Try to wait on (decrement) \cvar{a\_sma}, but fail after
		\cvar{a\_timeout} has expired if unable to.
	\end{capilist}
\label{sma_trywait}
\index{sma_trywait@\cfunc{sma\_trywait}{}}
\citem{\cfunc[cw\_bool\_t]{sma\_trywait}{cw\_sma\_t *a\_sma}}
	\begin{capilist}
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_sma: ]
			Pointer to a \classname{sma}.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			\begin{description}\item[]
			\item[FALSE: ] Success.
			\item[TRUE: ] Failure.
			\end{description}
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Try to wait on (decrement) \cvar{a\_sma}, but fail immediately
		instead of blocking if unable to.
	\end{capilist}
\label{sma_getvalue}
\index{sma_getvalue@\cfunc{sma\_getvalue}{}}
\citem{\cfunc[cw\_sint32\_t]{sma\_getvalue}{cw\_sma\_t *a\_sma}}
	\begin{capilist}
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_sma: ]
			Pointer to a \classname{sma}.
		\end{description}
	\item[Output(s): ]
		\begin{description}\item[]
		\item[retval: ]
			Value of semaphore.
		\end{description}
	\item[Exception(s): ] None.
	\item[Description: ]
		Get value of \cvar{a\_sma}.
	\end{capilist}
\label{sma_adjust}
\index{sma_adjust@\cfunc{sma\_adjust}{}}
\citem{\cfunc[void]{sma\_adjust}{cw\_sma\_t *a\_sma}}
	\begin{capilist}
	\item[Input(s): ]
		\begin{description}\item[]
		\item[a\_sma: ]
			Pointer to a \classname{sma}.
		\item[a\_adjust: ]
			Amount to adjust the value of \cvar{a\_sma} by.
		\end{description}
	\item[Output(s): ] None.
	\item[Exception(s): ] None.
	\item[Description: ]
		Adjust \cvar{a\_sma} by \cvar{a\_adjust}.
	\end{capilist}
\end{capi}
