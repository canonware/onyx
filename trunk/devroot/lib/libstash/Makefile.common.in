# -*-mode:makefile-*-
# @configure_input@
#############################################################################
#
# <Copyright = "jasone">
# <License>
#
#############################################################################
#
# $Source$
# $Author: jasone $
# Current revision: $Revision: 166 $
# Last modified: $Date: 1998-08-12 15:02:15 -0700 (Wed, 12 Aug 1998) $
#
# Description: Stub included by every Makefile.mk.
#              
##############################################################################

#
# Generate the knarly lists of files.
#
CURRDIR := $(strip $(CURRDIR))

#
# Includes
#
ifneq ($(strip $($(CURRDIR)_INCS)),) # Include files in this directory.
$(CURRDIR)_INCS := $(addprefix $(CURRDIR)/,$($(CURRDIR)_INCS))
INCPATH := $(INCPATH) -I$(CURRDIR)
INCS := $(INCS) $($(CURRDIR)_INCS)
vpath %.h $(CURRDIR)
endif

#
# Library
#
ifneq ($(strip $(LIB)),) # Library source files in this subdirectory.

ifeq ($(strip $($(LIB)_LIB)),)
$(LIB)_LIB := $(LIB)
LNKLIBS := lib$(LIB).la $(LNKLIBS)
LIBS := $(LIBS) $(LIB:%=lib%.la)
endif

#
# Library includes (headers to be installed for use with libraries)
#
ifneq ($(strip $($(CURRDIR)_LINCS)),) # Library include files in this dir.
LIB_LINCS := $(LIB_LINCS) $(addprefix $(CURRDIR)/,$($(CURRDIR)_LINCS))

ifeq ($(strip $($(CURRDIR)_INCS)),) # Still need to add dir to INCPATH.
INCPATH := $(INCPATH) -I$(CURRDIR)
endif
LINCS := $(LINCS) $($(CURRDIR)_LINCS)
vpath %.h $(CURRDIR)
endif

#
# Library sources
#
ifneq ($(strip $($(CURRDIR)_LSRCS)),) # Source files in this directory.
$(CURRDIR)_LSRCS := $(addprefix $(CURRDIR)/,$($(CURRDIR)_LSRCS))
$(CURRDIR)_LOBJS := $($(CURRDIR)_LSRCS:.c=.lo)
LSRCS := $(LSRCS) $($(CURRDIR)_LSRCS)
LOBJS := $(LOBJS) $($(CURRDIR)_LOBJS)

# Add an update rule for the objects in this directory.
lib$(LIB).la : $($(CURRDIR)_LOBJS)
	$(LIBTOOL) $(CC) -o $@ $^ $(LIBPATH) $(EXTRALIBS) -rpath @prefix@/lib

vpath %.d $(CURRDIR)
vpath %.c $(CURRDIR)
vpath %.lo $(CURRDIR)
endif

$(LIB) :=# Clear out the variable.
endif

#
# Tests
#
ifneq ($(strip $($(CURRDIR)_CTESTS)),) # Building executables here.
$(CURRDIR)_CTESTS := $(addprefix $(CURRDIR)/,$($(CURRDIR)_CTESTS:.c=))

CTESTS := $(CTESTS) $($(CURRDIR)_CTESTS)

vpath %.d $(CURRDIR)
vpath %.c $(CURRDIR)
vpath %.lo $(CURRDIR)
endif

ifneq ($(strip $($(CURRDIR)_CTESTS)),) # Building perl back end executables.
$(CURRDIR)_BTESTS := $(addprefix $(CURRDIR)/,$($(CURRDIR)_BTESTS:.c=))

BTESTS := $(BTESTS) $($(CURRDIR)_BTESTS)

ifeq ($(strip $($(CURRDIR)_CTESTS)),)
# Need to add these vpaths, since it wasn't done above.
vpath %.d $(CURRDIR)
vpath %.c $(CURRDIR)
vpath %.lo $(CURRDIR)
endif

endif

ifneq ($(strip $($(CURRDIR)_PTESTS)),) # Building perl tests here.
$(CURRDIR)_PTESTS := $(addprefix $(CURRDIR)/,$($(CURRDIR)_PTESTS:.pl.in=.pl))

PTESTS := $(PTESTS) $($(CURRDIR)_PTESTS)

vpath %.pl $(CURRDIR)
vpath %.pl.in $(CURRDIR)

endif
