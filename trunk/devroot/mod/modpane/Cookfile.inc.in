/******************************************************************************
 *
 * <Copyright = jasone>
 * <License>
 *
 ******************************************************************************
 *
 * Version: Onyx <Version = onyx>
 *
 * Cookfile for modpane.
 *
 ******************************************************************************/

/* Include generated dependency files. */
#include-cooked [glob @objroot@/mod/modpane/src/"*.d_*"]
#include-cooked [glob @objroot@/mod/modpane/test/"*.d_*"]

/*
 * File lists.
 */

/* Source files. */
MODPANE_SRCS = [addprefix @srcroot@/mod/modpane/src/
                          display.c ds.c pane.c pn.c modpane.c
                          ];

/* Generated source code (created by configure). */
MODPANE_NX_GEN = [fromto %.nx.in @objroot@/mod/modpane/nx/modpane/%.nx
                         modpane_defs.nx.in
                         ];

MODPANE_NX = [addprefix @srcroot@/mod/modpane/nx/modpane/
                        modpane.nx
                        ];

/* Modules. */
MODPANE = @objroot@/mod/modpane/nxm/modpane.nxm;

/*
 * User cook'ables.
 */

modpane : [MODPANE];

modpane_mods_tests :
{
}

modpane_mods_check : modpane_mods_tests
{
}

modpane_mods_check_update :
{
}

modpane_mods_install : [MODPANE]
{
  @INSTALL@ -d [PREFIX]/share/onyx-@onyx_version@/nxm;
  @INSTALL@ -m 0444 [MODPANE] [PREFIX]/share/onyx-@onyx_version@/nxm;
  @INSTALL@ -d [PREFIX]/share/onyx-@onyx_version@/nx/modpane;

  loop local f = [MODPANE_NX] [MODPANE_NX_GEN]
  {
    @INSTALL@ -m 0644 [f] [PREFIX]/share/onyx-@onyx_version@/nx/modpane/;
  }
}

modpane_mods_uninstall :
{
  rm -f [PREFIX]/share/onyx-@onyx_version@/nxm/modpane.nxm;
  rm -rf [PREFIX]/share/onyx-@onyx_version@/nx/modpane;
}

modpane_mods_clean :
{
  rm -f [fromto @srcroot@/%0%.c @objroot@/%0%.d_s [MODPANE_SRCS]];
  rm -f [fromto @srcroot@/%0%.c @objroot@/%0%.o_s [MODPANE_SRCS]];
  rm -f [MODPANE];
}

modpane_mods_distclean :
{
}

/*
 * Various flags.
 */

MODPANE_CPPFLAGS = @MODPANE_CPPFLAGS@;
MODPANE_LDFLAGS = @MODPANE_LDFLAGS@;

CPPFLAGS = [CPPFLAGS] -I@srcroot@/mod/modpane/include
                      -I@objroot@/mod/modpane/include
                      [MODPANE_CPPFLAGS];

/*
 * Dependencies.
 */

[MODPANE] : [fromto @srcroot@/%0%.c @objroot@/%0%.o_s [MODPANE_SRCS]]
  set mkdir
{
  [CC]
#if [matches elf @abi@]
       -shared
#elif [matches macho @abi@]
       -undefined suppress -flat_namespace -bundle -all_load -bind_at_load
#endif
       -o [target] [need] [MODPANE_LDFLAGS];
}
