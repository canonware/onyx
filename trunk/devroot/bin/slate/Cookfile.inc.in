/******************************************************************************
 *
 * <Copyright = jasone>
 * <License>
 *
 ******************************************************************************
 *
 * Version: Slate <Version = slate>
 *
 * Cookfile for slate.
 *
 ******************************************************************************/

/* Include generated dependency files. */
#include-cooked [glob @objroot@/bin/slate/src/"*.d_*"]

/*
 * File lists.
 */

/* Source files. */
SLATE_SRCS = buf.c buffer.c hist.c slate.c slate_ops.c;
SLATE_SRCS = [fromto % @srcroot@/bin/slate/src/% [SLATE_SRCS]];

TSLATE_SRCS = tslate.c;
TSLATE_SRCS = [fromto % @srcroot@/bin/slate/src/% [TSLATE_SRCS]];

/* LaTeX source files. */
SLATE_TEX_SRCS = ;
SLATE_TEX_SRCS = [fromto % @srcroot@/bin/slate/doc/latex/% [SLATE_TEX_SRCS]];
/* SLATE_TEX_SRCS = [SLATE_TEX_SRCS] @objroot@/bin/slate/doc/latex/manual.tex; */

/* Binaries. */
SLATE = @objroot@/bin/slate/bin/slate;
TSLATE = @objroot@/bin/slate/bin/tslate;

[TSLATE] : [SLATE];

/*
 * User cook'ables.
 */

slate : [SLATE] [TSLATE];

slate_bins_tests :
{
}

slate_bins_check :
{
}

slate_bins_check_update :
{
}

slate_bins_bootstrap : onyx
{
  cat @srcroot@/bin/slate/src/slate_nxcode.nx
    | @ONYX@ @srcroot@/bin/slate/src/slate_nxcode_gen.nx
    > @srcroot@/bin/slate/src/slate_nxcode.c;
}

slate_bins_install : [SLATE]
#if @enable_libonyx@
                libonyx_libs_install_s
#endif
{
  @INSTALL@ -d [PREFIX]/bin;

  [CC] [A_CFLAGS] -o [PREFIX]/bin/slate-@slate_version@
       [fromto @srcroot@/%0%.c @objroot@/%0%.o_a [SLATE_SRCS]]
#if @enable_libonyx@
#if [matches elf @abi@]
       @RPATH@[PREFIX]/lib
#endif
#endif
       [LDFLAGS] -lonyx @LIBS@;
  chmod 0755 [PREFIX]/bin/slate-@slate_version@;
  ln -s slate-@slate_version@ [PREFIX]/bin/slate;

  @INSTALL@ -d [PREFIX]/man/man1;
  @INSTALL@ -m 0444 @objroot@/bin/slate/man/man1/slate.1 [PREFIX]/man/man1;

  ln -s slate-@slate_version@ [PREFIX]/share/slate;
}

slate_bins_uninstall :
{
  rm -f [PREFIX]/bin/slate-@slate_version@;
  rm -f [PREFIX]/bin/slate;
  rm -f [PREFIX]/man/man1/slate.1;
  rm -f [PREFIX]/share/slate;
}

slate_bins_clean :
{
  rm -f [fromto @srcroot@/%0%.c @objroot@/%0%.d_a [SLATE_SRCS] [TSLATE_SRCS]];
  rm -f [fromto @srcroot@/%0%.c @objroot@/%0%.o_a [SLATE_SRCS] [TSLATE_SRCS]];
  rm -f [SLATE] [TSLATE];
}

slate_bins_distclean :
{
}

/*
 * Dependencies.
 */

[TSLATE] : [fromto @srcroot@/%0%.c @objroot@/%0%.o_a [TSLATE_SRCS]]
  set mkdir
{
  [CC] [A_CFLAGS] -o [target]
       [fromto @srcroot@/%0%.c @objroot@/%0%.o_a [TSLATE_SRCS]];
}

[SLATE] : [fromto @srcroot@/%0%.c @objroot@/%0%.o_a [SLATE_SRCS]]
#if @enable_libonyx@
          libonyx_libs_s
#endif
  set mkdir
{
  [CC] [A_CFLAGS] -o [target]
       [fromto @srcroot@/%0%.c @objroot@/%0%.o_a [SLATE_SRCS]]
#if @enable_libonyx@
#if [matches elf @abi@]
       @RPATH@@abs_objroot@/lib/libonyx/lib
#endif
#endif
       [LDFLAGS] -lonyx @LIBS@;
}
