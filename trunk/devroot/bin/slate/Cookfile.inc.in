/******************************************************************************
 *
 * <Copyright = jasone>
 * <License>
 *
 ******************************************************************************
 *
 * Version: Slate <Version = slate>
 *
 * Cookfile for slate.
 *
 ******************************************************************************/

/* Include generated dependency files. */
#include-cooked [glob [objdir]/bin/slate/src/"*.d_*"]

/*
 * File lists.
 */

/* Source files. */
SLATE_SRCS = buf.c buffer.c hist.c slate.c slate_ops.c;
SLATE_SRCS = [fromto % [srcdir]/bin/slate/src/% [SLATE_SRCS]];

TSLATE_SRCS = tslate.c;
TSLATE_SRCS = [fromto % [srcdir]/bin/slate/src/% [TSLATE_SRCS]];

/* LaTeX source files. */
SLATE_TEX_SRCS = ;
SLATE_TEX_SRCS = [fromto % [srcdir]/bin/slate/doc/latex/% [SLATE_TEX_SRCS]];
/* SLATE_TEX_SRCS = [SLATE_TEX_SRCS] [objdir]/bin/slate/doc/latex/manual.tex; */

/* Binaries. */
SLATE = [objdir]/bin/slate/bin/slate;
TSLATE = [objdir]/bin/slate/bin/tslate;

[TSLATE] : [SLATE];

/*
 * User cook'ables.
 */

slate : [SLATE] [TSLATE];

slate_bins_tests :
{
}

slate_bins_check :
{
}

slate_bins_check_update :
{
}

slate_bins_bootstrap : onyx
{
  cat [srcdir]/bin/slate/src/slate_nxcode.nx
    | [ONYX] [srcdir]/bin/slate/src/slate_nxcode_gen.nx
    > [srcdir]/bin/slate/src/slate_nxcode.c;
}

slate_bins_install : [SLATE]
#if @enable_libonyx@
                libonyx_libs_install_s
#endif
{
  [INSTALL] -d [PREFIX]/bin;

  [CC] [A_CFLAGS] -o [PREFIX]/bin/slate
       [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [SLATE_SRCS]]
#if @enable_libonyx@
#if [matches elf [abi]]
       [RPATH][PREFIX]/lib
#endif
#endif
       [LDFLAGS] -lonyx
       [EXTRALIBS];
  [CHMOD] 0755 [PREFIX]/bin/slate;

  [INSTALL] -d [PREFIX]/man/man1;
  [INSTALL] -m 0444 [objdir]/bin/slate/man/man1/slate.1 [PREFIX]/man/man1;
}

slate_bins_uninstall :
{
  rm -f [PREFIX]/bin/slate;
  rm -f [PREFIX]/man/man1/slate.1;
}

slate_bins_clean :
{
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_a [SLATE_SRCS] [TSLATE_SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [SLATE_SRCS] [TSLATE_SRCS]];
  rm -f [SLATE] [TSLATE];
}

slate_bins_distclean :
{
}

/*
 * Dependencies.
 */

[TSLATE] : [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [TSLATE_SRCS]]
  set mkdir
{
  [CC] [A_CFLAGS] -o [target]
       [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [TSLATE_SRCS]];
}

[SLATE] : [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [SLATE_SRCS]]
#if @enable_libonyx@
          libonyx_libs_s
#endif
  set mkdir
{
  [CC] [A_CFLAGS] -o [target]
       [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [SLATE_SRCS]]
#if @enable_libonyx@
#if [matches elf [abi]]
       [RPATH][abs_objdir]/lib/libonyx/lib
#endif
#endif
       [LDFLAGS] -lonyx
       [EXTRALIBS];
}
