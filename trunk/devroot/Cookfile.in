/******************************************************************************
 *
 * <Copyright = jasone>
 * <License>
 *
 ******************************************************************************
 *
 * Version: <Version>
 *
 * Master Canonware Cookfile.
 *
 ******************************************************************************/

/*
 * Standard definitions.
 */

/* Paths. */
srcdir = @top_srcdir@;
abs_srcdir = @abs_srcdir@;
objdir = @objdir@;
abs_objdir = @abs_objdir@;
PREFIX = @prefix@;

/* Paths to programs used by the build system. */
SHELL = /bin/sh;
CC = @CC@;
AR = @AR@;
LD = @LD@;
LN = @LN@;
RANLIB = @RANLIB@;
BASENAME = @BASENAME@;
CHMOD = @CHMOD@;
INSTALL = @INSTALL@;
PERL = @PERL@;
CAT = @CAT@;
DIFF = @DIFF@;
VERIFY = @VERIFY@;
LATEX = @LATEX@;
DVIPS = @DVIPS@;
DVIPDFM = @DVIPDFM@;
FIG2DEV = @FIG2DEV@;
LATEX2HTML = @LATEX2HTML@;

/* Build parameters. */
CPPFLAGS = ;
D_CPPFLAGS = -D_REENTRANT @CPPFLAGS@;
A_CPPFLAGS = -D_REENTRANT @CPPFLAGS@;
P_CPPFLAGS = -D_REENTRANT @CPPFLAGS@;
S_CPPFLAGS = -D_REENTRANT @CPPFLAGS@;

/* CFLAGS = -Wall -pipe -g3 @CFLAGS@; */
CFLAGS = -pipe -g3 @CFLAGS@;
D_CFLAGS = [CFLAGS];
A_CFLAGS = [CFLAGS] -O;
P_CFLAGS = [CFLAGS] -O -pg;
S_CFLAGS = [CFLAGS] -fPIC -DPIC;

ENABLE_SHARED = @enable_shared@;
LDFLAGS = @LDFLAGS@;
EXTRALIBS = @LIBS@;

/* Documentation. */
#include-cooked [srcdir]/doc/Cookfile.inc

/* Tests. */
#include-cooked [srcdir]/test/Cookfile.inc

/* Libraries. */
#include-cooked [srcdir]/lib/c/Cookfile.inc
#include-cooked [fromto % [srcdir]/lib/c/%/Cookfile.inc @libs@]

/* Programs. */
#include-cooked [srcdir]/bin/Cookfile.inc
#include-cooked [fromto % [srcdir]/bin/%/Cookfile.inc @bins@]

/*
 * User targets.
 */

standard : libs bins_a
  set default
;

all : libs bins tests doc;

libs_d : [D_LIBS];
libs_a : [A_LIBS];
libs_p : [P_LIBS];
libs_s : [S_LIBS];
libs : libs_d libs_a libs_p
#if [ENABLE_SHARED]
       libs_s
#endif
;

bins_d : [D_BINS];
bins_a : [A_BINS];
bins_p : [P_BINS];
bins : bins_d bins_a bins_p;

tests : [STIL_D]
        [fromto [srcdir]/%0%.c [objdir]/%0% [CTESTS] [CBTESTS]]
        [fromto [srcdir]/%0%.st.in [objdir]/%0%.st [STESTS] [SBTESTS]]
        [fromto [srcdir]/%0%.pl.in [objdir]/%0%.pl [PTESTS]];

check : tests
{
  [VERIFY] -z -r [srcdir] -o [objdir]
           [fromto [srcdir]/%0%.c [objdir]/%0% [CTESTS]]
           [fromto [srcdir]/%0%.st.in [objdir]/%0%.st [STESTS]]
           [fromto [srcdir]/%0%.pl.in [objdir]/%0%.pl [PTESTS]];
}

check_update : tests
{
  [VERIFY] -u -z -r [srcdir] -o [objdir]
           [fromto [srcdir]/%0%.c [objdir]/%0% [CTESTS]]
           [fromto [srcdir]/%0%.st.in [objdir]/%0%.st [STESTS]]
           [fromto [srcdir]/%0%.pl.in [objdir]/%0%.pl [PTESTS]];
}

release : doc;

doc : manual_p manual_f manual_h;

manual_p : [P_MANUAL];

manual_f : [F_MANUAL];

manual_h : [H_MANUAL];

install_bins : [addsuffix _install_a @bins@];
install_libs : [addsuffix _install @libs@];
install : install_bins install_libs install_doc;

uninstall_bins : [addsuffix _uninstall @bins@];
uninstall_libs : [addsuffix _uninstall @libs@];
uninstall : uninstall_bins uninstall_libs uninstall_doc
{
  rm -rf [PREFIX]/share/canonware;
}

clean : [addsuffix _clean doc test @bins@ @libs@]
{
  rm -f core *.core;
  rm -f TAGS;

  rm -f [D_LIBS];
  rm -f [A_LIBS];
  rm -f [P_LIBS];
  rm -f [S_LIBS];
  rm -f [S_LINKS];

  rm -f [D_BINS];
  rm -f [A_BINS];
  rm -f [P_BINS];

  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_d [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_a [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_p [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_s [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_d [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_p [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_s [SRCS]];

  /*
   * Delete .cook.fp files from the source tree and object tree.
   * Delete Cookfile.list files from the object tree. 
   */
  [SHELL] -e;
data
#![SHELL]

for i in `find [srcdir] -type f -name .cook.fp` ; do
	echo rm $i;
	rm $i;
done
for i in `find [objdir] -type f -name .cook.fp` ; do
	echo rm $i;
	rm $i;
done
for i in `find [objdir] -type f -name Cookfile.list` ; do
	echo rm $i;
	rm $i;
done
dataend
}

distclean : clean [addsuffix _distclean doc test @bins@ @libs@]
{
  rm -f [objdir]/Cookfile;
  rm -f [objdir]/config.cache;
  rm -f [objdir]/config.log;
  rm -f [objdir]/config.status;
  rm -f [objdir]/test/verify;
  rm -f @cfghdrs@;
}

relclean : distclean [addsuffix _relclean doc]
{
}

etags : [INCS] [PRIV_INCS] [SRCS]
{
  @ETAGS@ [INCS] [PRIV_INCS] [SRCS];
}
