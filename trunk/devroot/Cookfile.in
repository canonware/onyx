/******************************************************************************
 *
 * <Copyright = jasone>
 * <License>
 *
 ******************************************************************************
 *
 * Version: <Version>
 *
 * Master Cookfile.
 *
 ******************************************************************************/

/*
 * Standard definitions.
 */

/* Paths. */
srcdir = @top_srcdir@;
abs_srcdir = @abs_srcdir@;
objdir = @objdir@;
abs_objdir = @abs_objdir@;
if [not [defined PREFIX]] then
  PREFIX = [split " " [strip "@prefix@"]];

/* Executable format. */
abi = @abi@;

/* Paths to programs used by the build system. */
SHELL = /bin/sh;
if [not [defined CC]] then
  CC = [split " " [strip "@CC@"]];
AR = @AR@;
LD = @LD@;
LN = @LN@;
RANLIB = @RANLIB@;
BASENAME = @BASENAME@;
CHMOD = @CHMOD@;
INSTALL = @INSTALL@;
PERL = @PERL@;
CAT = @CAT@;

/* Build parameters. */
if [not [defined CPPFLAGS]] then
  CPPFLAGS = [split " " [strip "@CPPFLAGS@"]];
CPPDEFS = -D_REENTRANT;

if [not [defined CFLAGS]] then
  CFLAGS = [split " " [strip "@CFLAGS@"]];
A_CFLAGS = [CFLAGS];
S_CFLAGS = [CFLAGS] -fPIC -DPIC
#if [matches macho [abi]]
           -dynamic
#endif
           ;

if [not [defined LDFLAGS]] then
  LDFLAGS = [split " " [strip "@LDFLAGS@"]];
EXTRALIBS = @LIBS@;
RPATH = @RPATH@;

/* Documentation. */
#include-cooked [srcdir]/doc/Cookfile.inc

/* Examples. */
#include-cooked [srcdir]/examples/Cookfile.inc

/* Tests. */
#include-cooked [srcdir]/test/Cookfile.inc

/* Binaries. */
#include-cooked [srcdir]/bin/Cookfile.inc

/* Libraries. */
#include-cooked [srcdir]/lib/Cookfile.inc

/* Modules. */
#include-cooked [srcdir]/mod/Cookfile.inc

/*
 * User targets.
 */

all : libs mods bins examples tests docs
  set default
;

bootstrap : [addsuffix _bootstrap bins libs];

release : docs;

mods_install : [addsuffix _install @mods@];
install : [addsuffix _install bins mods libs docs];

mods_uninstall : [addsuffix _uninstall @mods@];
uninstall : [addsuffix _uninstall bins mods libs docs];

clean : [addsuffix _clean docs tests bins mods libs]
{
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_d [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_a [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_p [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_s [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_d [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_p [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_s [SRCS]];

  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_s [MSRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_s [MSRCS]];

  /*
   * Delete .cook.fp files from the source tree and object tree.
   * Delete Cookfile.list files from the object tree. 
   */
  [SHELL] -e;
data
#![SHELL]

for i in `find [srcdir] -type f -name .cook.fp` ; do
	echo rm $i;
	rm $i;
done
for i in `find [objdir] -type f -name .cook.fp` ; do
	echo rm $i;
	rm $i;
done
for i in `find [objdir] -type f -name Cookfile.list` ; do
	echo rm $i;
	rm $i;
done
dataend
}

distclean : clean [addsuffix _distclean tests bins mods libs]
{
  rm -f [objdir]/config.log;
  rm -f [objdir]/config.status;
  rm -f @cfghdrs@;
  rm -f @cfgoutputs@;
}

relclean : distclean [addsuffix _relclean docs];
