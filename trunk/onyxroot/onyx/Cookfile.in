/******************************************************************************
 *
 * <Copyright = jasone>
 * <License>
 *
 ******************************************************************************
 *
 * Version: <Version>
 *
 * Master Onyx Cookfile.
 *
 ******************************************************************************/

/*
 * Standard definitions.
 */

/* Paths. */
srcdir = @top_srcdir@;
abs_srcdir = @abs_srcdir@;
objdir = @objdir@;
abs_objdir = @abs_objdir@;
PREFIX = @prefix@;

/* Executable format. */
abi = @abi@;

/* Paths to programs used by the build system. */
SHELL = /bin/sh;
CC = @CC@;
AR = @AR@;
LD = @LD@;
LN = @LN@;
RANLIB = @RANLIB@;
BASENAME = @BASENAME@;
CHMOD = @CHMOD@;
INSTALL = @INSTALL@;
PERL = @PERL@;
CAT = @CAT@;
DIFF = @DIFF@;
VERIFY = @VERIFY@;
LATEX = @LATEX@;
PDFLATEX = @PDFLATEX@;
DVIPS = @DVIPS@;
FIG2DEV = @FIG2DEV@;
LATEX2HTML = @LATEX2HTML@;
MAKEINDEX = @MAKEINDEX@;
GTKCONFIG = @GTKCONFIG@;

/* Build parameters. */
CPPFLAGS = @CPPFLAGS@;
CPPDEFS = -D_REENTRANT;

CFLAGS = @CFLAGS@;
A_CFLAGS = [CFLAGS];
S_CFLAGS = [CFLAGS] -fPIC -DPIC;

LDFLAGS = @LDFLAGS@;
EXTRALIBS = @LIBS@;
RPATH = @RPATH@;

libs = @libs@;
mods = @mods@;
bins = @bins@;

enable_threads = @enable_threads@;
enable_posix = @enable_posix@;
enable_posix_file = @enable_posix_file@;
enable_libedit = @enable_libedit@;

BOOTSTRAP = ;

/* Documentation. */
#include-cooked [srcdir]/doc/Cookfile.inc

/* Tests. */
#include-cooked [srcdir]/test/Cookfile.inc

/* Libraries. */
#include-cooked [srcdir]/lib/c/Cookfile.inc
#include-cooked [fromto % [srcdir]/lib/c/%/Cookfile.inc @libs@]

/* Modules. */
#include-cooked [srcdir]/mod/Cookfile.inc
#include-cooked [fromto % [srcdir]/mod/%/Cookfile.inc @mods@]

/* Programs. */
#include-cooked [srcdir]/bin/Cookfile.inc
#include-cooked [fromto % [srcdir]/bin/%/Cookfile.inc @bins@]

/*
 * User targets.
 */

standard : libs mods bins
  set default
;

all : libs mods bins tests docs;

libs_a : [A_LIBS];
libs_s : [S_LIBS];
libs : libs_a libs_s;

mods : [MODS];

bins : [BINS];

bootstrap : [BOOTSTRAP];

tests : [TONYX] [MODS]
        [fromto [srcdir]/%0%.c [objdir]/%0% [CTESTS] [CBTESTS]]
        [fromto [srcdir]/%0%.nx.in [objdir]/%0%.nx [OTESTS] [OBTESTS]]
        [fromto [srcdir]/%0%.pl.in [objdir]/%0%.pl [PTESTS]];

check : tests
{
  [VERIFY] -s [srcdir] -o [objdir]
           [fromto [srcdir]/%0%.c [objdir]/%0% [CTESTS]]
           [fromto [srcdir]/%0%.nx.in [objdir]/%0%.nx [OTESTS]]
           [fromto [srcdir]/%0%.pl.in [objdir]/%0%.pl [PTESTS]];
}

check_update : tests
{
  [VERIFY] -u -s [srcdir] -o [objdir]
           [fromto [srcdir]/%0%.c [objdir]/%0% [CTESTS]]
           [fromto [srcdir]/%0%.nx.in [objdir]/%0%.nx [OTESTS]]
           [fromto [srcdir]/%0%.pl.in [objdir]/%0%.pl [PTESTS]];
}

release : docs;

docs : docs_ps docs_pdf docs_html;
docs_ps : [PS_ONYX];
docs_pdf : [PDF_ONYX];
docs_html : [HTML_ONYX];

install_bins : [addsuffix _install @bins@];
install_mods : [addsuffix _install @mods@];
install_libs : [addsuffix _install @libs@];
install : install_bins install_mods install_libs install_docs;

uninstall_bins : [addsuffix _uninstall @bins@];
uninstall_mods : [addsuffix _uninstall @mods@];
uninstall_libs : [addsuffix _uninstall @libs@];
uninstall : uninstall_bins uninstall_mods uninstall_libs uninstall_docs
{
  rm -rf [PREFIX]/share/canonware;
}

clean : [addsuffix _clean docs test @bins@ @mods@ @libs@]
{
  rm -f core *.core;
  rm -f *.gmon;
  rm -f TAGS;

  rm -f [A_LIBS];
  rm -f [S_LIBS];
  rm -f [S_LINKS];

  rm -f [MODS];

  rm -f [BINS];

  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_d [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_a [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_p [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_s [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_d [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_a [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_p [SRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_s [SRCS]];

  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.d_s [MSRCS]];
  rm -f [fromto [srcdir]/%0%.c [objdir]/%0%.o_s [MSRCS]];

  /*
   * Delete .cook.fp files from the source tree and object tree.
   * Delete Cookfile.list files from the object tree. 
   */
  [SHELL] -e;
data
#![SHELL]

for i in `find [srcdir] -type f -name .cook.fp` ; do
	echo rm $i;
	rm $i;
done
for i in `find [objdir] -type f -name .cook.fp` ; do
	echo rm $i;
	rm $i;
done
for i in `find [objdir] -type f -name Cookfile.list` ; do
	echo rm $i;
	rm $i;
done
dataend
}

distclean : clean [addsuffix _distclean docs test @bins@ @mods@ @libs@]
{
  rm -f [objdir]/Cookfile;
  rm -f [objdir]/config.cache;
  rm -f [objdir]/config.log;
  rm -f [objdir]/config.status;
  rm -f [objdir]/test/verify;
  rm -f @cfghdrs@;
}

relclean : distclean [addsuffix _relclean docs]
{
}

etags : [INCS] [PRIV_INCS] [MINCS] [SRCS] [MSRCS]
{
  @ETAGS@ [INCS] [PRIV_INCS] [MINCS] [SRCS] [MSRCS];
}
